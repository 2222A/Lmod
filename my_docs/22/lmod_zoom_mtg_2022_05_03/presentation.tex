\documentclass{beamer}

% You can also use a 16:9 aspect ratio:
%\documentclass[aspectratio=169]{beamer}
\usetheme{TACC16}

% It's possible to move the footer to the right:
%\usetheme[rightfooter]{TACC16}

%% page 
%\begin{frame}{}
%  \begin{itemize}
%    \item
%  \end{itemize}
%\end{frame}
%
%% page 
%\begin{frame}[fragile]
%    \frametitle{}
% {\tiny
%    \begin{semiverbatim}
%    \end{semiverbatim}
%}
%  \begin{itemize}
%    \item
%  \end{itemize}
%
%\end{frame}

\begin{document}
\title[Lmod]{The complicated story about TCL break}
\author{Robert McLay} 
\date{May. 3, 2022}

% page 1
\frame{\titlepage} 


% page 2
\begin{frame}{Outline}
  \center{\includegraphics[width=.9\textwidth]{Lmod-4color@2x.png}}
  \begin{itemize}
    \item Let's talk about TCL break (and LmodBreak)
    \item Lmod didn't really support TCL break at all until Lmod 8.6
      (really Lmod 8.7)
    \item Years ago mailing list question: support for break
    \item Lmod 6 and below could not support break
    \item Why?
  \end{itemize}
\end{frame}

% page 3
\begin{frame}[fragile]
    \frametitle{Reminder: How Lmod works}
  \begin{itemize}
    \item In order to have a command effect the current shell
    \item A simple module command for bash is given below
    \item The \$LMOD\_CMD command generate shell commands as text
    \item The eval "..." evaluate the text to change the current shell
    \item For the rest of this talk: focus on what \$LMOD\_CMD produces
  \end{itemize}
 {\small
    \begin{semiverbatim}
     module () \{ eval "\$(\$LMOD\_CMD bash "\$@")"; \}
    \end{semiverbatim}
}
\end{frame}

% page 4
\begin{frame}[fragile]
    \frametitle{Reminder: How Lmod TCL processing works}
  \begin{itemize}
    \item Internally Lmod knows when a file is a TCL modulefile 
    \item No *.lua extension
    \item The program tcl2lua.tcl is called to process the tcl 
    \item It converts TCL module command into Lua with Lmod module
      commands
  \end{itemize}
 {\tiny
    \begin{semiverbatim}
setenv FOO bar \Rightarrow setenv("FOO","bar")
prepend-path PATH /prgm/bin \Rightarrow prepend_path("PATH","/prgm/bin")
    \end{semiverbatim}
}
\end{frame}

% page 5
\begin{frame}{Why was TCL break such a problem for Lmod?}
  \begin{itemize}
    \item TCL break stops processing the current module
    \item It ignores any changes in a module that has a break
    \item But it keeps all other modules loaded.
    \item {\color{blue} \texttt{module load A B C D}} 
    \item Where C has a break
    \item Then A B are loaded but C and D are not.
  \end{itemize}
\end{frame}

% page 6
\begin{frame}{LmodError is different}
  \begin{itemize}
    \item {\color{blue} \texttt{module load A B C D}} 
    \item Where C has an LmodError()
    \item No modules are loaded.
  \end{itemize}
\end{frame}

% page 7
\begin{frame}{Lmod waits to produce output}
  \begin{itemize}
    \item When loading several modules, Lmod waits
    \item All module actions are completed internally
    \item Then Lmod generates shell command output.
    \item Lmod 6 and earlier wouldn't know what changes to ignore when
      processing a break.
    \item All Lmod's produce either an error or environment changes
      not both.
  \end{itemize}
\end{frame}


\end{document}
